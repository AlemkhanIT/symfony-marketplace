<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const removeFromBasketButtons = document.querySelectorAll('.remove');
                    removeFromBasketButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const basketId = this.getAttribute('data-basket-id');
                            if (confirm('Are you sure you want to remove this item from your basket?')) {
                                fetch(`/basket/remove/${basketId}`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'X-CSRF-TOKEN': '{{ csrf_token('remove_from_basket') }}'
                                    }
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.message) {
                                            alert(data.message);
                                            // Remove the card from the UI
                                            const card = this.closest('.card');
                                            card.remove();
                                            // Check if basket is empty
                                            const basketContainer = document.getElementById('basket-items-container');
                                            if (basketContainer.children.length === 0) {
                                                basketContainer.innerHTML = '<p>Your basket is empty.</p>';
                                            }
                                        } else if (data.error) {
                                            alert('Error: ' + data.error);
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                    });
                            }
                        });
                    });

                    const addToBasketButtons = document.querySelectorAll('.add-to-basket');
                    addToBasketButtons.forEach(button => {
                        button.addEventListener('click', function() {
                            const productId = this.getAttribute('data-product-id');
                            fetch('/basket/add', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-CSRF-TOKEN': '{{ csrf_token('basket_add') }}'
                                },
                                body: JSON.stringify({ product_id: productId })
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.message) {
                                        alert(data.message);
                                    } else if (data.error) {
                                        alert('Error: ' + data.error);
                                    }
                                })
                                .catch(error => {
                                    console.error('Error:', error);
                                    alert('An error occurred while adding the product to the basket.');
                                });
                        });
                    });
                });
            </script>
        {% endblock %}
    </head>
    <body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">Navbar</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/products">Products</a>
                        </li>
                    </ul>
                    {% if app.user %}
                        <a class="ms-1 btn btn-outline-success" href="{{ path('get_basket')}}" @click="isOpen = false">Basket</a>
                    {% endif %}
                     <a class="btn btn-outline-success" href="{{ app.user? path('app_logout'): path('app_login') }}" @click="isOpen = false">{{ app.user? 'Logout': 'Login' }}</a>
                    {% if not app.user %}
                        <a class="ms-1 btn btn-outline-success" href="{{ path('app_register')}}" @click="isOpen = false">Register</a>
                    {% endif %}

                </div>
            </div>
        </nav>
    </header>
        {% block body %}{% endblock %}
    </body>
</html>
